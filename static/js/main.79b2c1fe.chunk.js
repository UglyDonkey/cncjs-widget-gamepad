(this["webpackJsonpcncjs-widget-gamepad"]=this["webpackJsonpcncjs-widget-gamepad"]||[]).push([[0],{51:function(t,e,n){},57:function(t,e,n){var i=n(58);t.exports=function(t,e){var n=t.host,o=t.token,c="ws://".concat(n,"?token=").concat(o),a=i.connect("ws://".concat(n),{query:"token="+o});a.on("connect",(function(){console.log("Connected to "+c),e(null,a)})),a.on("error",(function(t){console.error("Connection error."),a&&(a.destroy(),a=null)})),a.on("close",(function(){console.log("Connection closed.")})),a.on("serialport:error",(function(t){e(new Error('Error opening serial port "'+t.port+'"'))})),a.on("serialport:read",(function(t){}))}},88:function(t,e){},93:function(t,e,n){"use strict";n.r(e);var i=n(3),o=n(4),c=function(){function t(e){return Object(i.a)(this,t),this.callback=null,this.observer=null,"function"===typeof e&&(this.callback=e),this}return Object(o.a)(t,[{key:"observe",value:function(t){var e=this;this.observer&&(this.observer.disconnect(),this.observer=null),this.callback&&this.callback(),this.observer=new MutationObserver((function(t){e.callback&&e.callback()})),this.observer.observe(t,{attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0})}},{key:"disconnect",value:function(){this.observer&&(this.observer.disconnect(),this.observer=null)}}]),t}();e.default=c},94:function(t,e,n){"use strict";n.r(e);var i,o,c=n(0),a=n.n(c),r=n(15),s=n.n(r),u=(n(51),n(8)),l=n(5),d=n(3),f=n(4),h=n(2),v=new(function(){function t(){Object(d.a)(this,t),this.selected=void 0,this.available=[],this.deadzone=.15,Object(h.d)(this)}return Object(f.a)(t,[{key:"connected",value:function(t){var e=this.available.findIndex((function(e){return e.index===t.index}));-1===e?this.available.push(t):this.available[e]=t}},{key:"disconnected",value:function(t){var e,n=this.available.findIndex((function(e){return e.index===t.index}));-1!==n&&this.available.splice(n,1),(null===(e=this.selected)||void 0===e?void 0:e.index)===t.index&&(this.selected=void 0)}},{key:"select",value:function(t){0!==this.available.filter((function(e){return e.index===t.index})).length&&(this.selected=t)}},{key:"normalize",get:function(){return 1/(1-this.deadzone)}},{key:"setDeadzone",value:function(t){this.deadzone=t}}]),t}()),b=n(9),p=b.a.div(i||(i=Object(u.a)(["\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    width: 100%;\n"]))),j=n(1),O=Object(l.a)((function(){return Object(j.jsx)(p,{children:v.selected?"using: ".concat(v.selected.name):"please select gamepad"})})),g=Object(l.a)((function(){return Object(j.jsx)("div",{children:0===v.available.length?"no gamepads detected":v.available.map((function(t){return Object(j.jsx)(k,{gamepad:t},t.index)}))})})),k=function(t){var e=t.gamepad,n=e.name;return Object(j.jsx)(p,{as:"button",onClick:function(){return v.select(e)},children:n})},x=new(function(){function t(){Object(d.a)(this,t),this.port=void 0,Object(h.d)(this)}return Object(f.a)(t,[{key:"setPort",value:function(t){this.port=t}}]),t}()),y=Object(l.a)((function(){return Object(j.jsxs)("div",{children:["Port: ",x.port]})})),m=Object(l.a)((function(){return Object(j.jsxs)("div",{children:["Deadzone:"," ",Object(j.jsx)("input",{type:"number",value:v.deadzone,onChange:function(t){return v.setDeadzone(Number.parseFloat(t.target.value))}})]})})),w=n(6),I=n(25),F=n.n(I),C=n(45),z=n(46),S=new URLSearchParams(window.location.search),P={token:S.get("token"),host:S.get("host")||""},M=n(57),D=function(){function t(e){Object(d.a)(this,t),this.socket=void 0,this.port=void 0,this.socket=e,this.port=void 0,this.setupListeners(),this.setupPort(),Object(h.d)(this)}return Object(f.a)(t,[{key:"sendGcode",value:function(t){this.port&&this.socket.emit("write",this.port,"".concat(t,"\n"))}},{key:"on",value:function(t){this.socket.on("serialport:read",t)}},{key:"off",value:function(t){this.socket.off("serialport:read",t)}},{key:"setupPort",value:function(){this.socket.emit("list")}},{key:"openPort",value:function(t){this.socket.emit("open",t)}},{key:"closePort",value:function(){this.port=void 0,x.setPort(void 0)}},{key:"setupListeners",value:function(){var t=this;this.socket.on("serialport:open",(function(e){var n=e.port;t.port=n,x.setPort(n)})),this.socket.on("serialport:list",(function(e){var n,i=null===(n=e.find((function(t){return t.inuse})))||void 0===n?void 0:n.port;i&&t.openPort(i)})),this.socket.on("serialport:change",(function(e){var n=e.port,i=e.inuse;n!==t.port||i?!t.port&&i&&t.openPort(n):t.closePort()}))}}]),t}(),G=function(){var t=Object(C.a)(F.a.mark((function t(){var e;return F.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(z.promisify)(M)(P);case 2:e=t.sent,o=new D(e);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),E=function(){return o},L=function(t){var e=v.deadzone,n=v.normalize;return Math.abs(t)<e?0:t>0?(t-e)*n:(t+e)*n},R=function(){var t=v.selected;if(!t)return{x:0,y:0,z:0};var e=navigator.getGamepads()[t.index];if(!e)return{x:0,y:0,z:0};var n=e.axes;return{x:L(n[0]),y:L(-n[1]),z:L(-n[3])}},H=String.fromCharCode(133),W=function(){function t(e){var n=this;Object(d.a)(this,t),this.state=void 0,this.isStopped=!0,this.fetchInterval=void 0,this.lastFetch=0,this.onOk=function(t){"ok"===t&&n.state.enabled&&n.fetch()},this.fetch=function(){if(n.state.enabled){var t=Math.min(n.getDt(),15),e=R(),i=e.x,o=e.y,c=e.z,a=i*i+o*o+c*c;if(0===a)n.stop();else{var r=Math.sqrt(a)*T.maxFeedRate,s=.001*r*t;console.log({x:i,f:r,dt:t,multiplier:s}),n.jog({x:i*s,y:o*s,z:c*s,f:r}),n.isStopped=!1,n.stopIdleFetch()}}},this.state=e,Object(h.g)((function(){return e.enabled}),(function(){return e.enabled?n.on():n.off()}))}return Object(f.a)(t,[{key:"on",value:function(){var t;console.log("jogger on"),null===(t=E())||void 0===t||t.on(this.onOk),this.lastFetch=(new Date).getTime(),this.startIdleFetch()}},{key:"off",value:function(){var t;console.log("jogger off"),this.stop(),null===(t=E())||void 0===t||t.off(this.onOk),this.stopIdleFetch()}},{key:"getDt",value:function(){var t=(new Date).getTime(),e=t-this.lastFetch;return this.lastFetch=t,e}},{key:"jog",value:function(t){var e,n=Object.entries(t).map((function(t){var e=Object(w.a)(t,2),n=e[0],i=e[1];return"".concat(n.toUpperCase()).concat(i.toFixed(4))})).join(" ");null===(e=E())||void 0===e||e.sendGcode("$J=G91 ".concat(n))}},{key:"stop",value:function(){var t;this.isStopped||(null===(t=E())||void 0===t||t.sendGcode(H),this.isStopped=!0,this.startIdleFetch())}},{key:"startIdleFetch",value:function(){this.fetchInterval||(this.fetchInterval=setInterval(this.fetch,20))}},{key:"stopIdleFetch",value:function(){this.fetchInterval&&(clearInterval(this.fetchInterval),this.fetchInterval=void 0)}}]),t}(),J=new(function(){function t(){Object(d.a)(this,t),this.enabled=!1,this.maxFeedRate=300,Object(h.d)(this)}return Object(f.a)(t,[{key:"toggle",value:function(){this.enabled=!this.enabled}},{key:"setMaxFeedRate",value:function(t){this.maxFeedRate=t}},{key:"off",value:function(){this.enabled=!1}}]),t}());new W(J);var T=J,A=Object(l.a)((function(){return Object(c.useEffect)((function(){return function(){return T.off()}}),[]),Object(j.jsx)(p,{as:"button",onClick:function(){return T.toggle()},children:T.enabled?"jogging enabled":"jogging stopped"})})),N=Object(l.a)((function(){return Object(j.jsxs)("div",{children:["Feed Rate:"," ",Object(j.jsx)("input",{type:"number",value:T.maxFeedRate,onChange:function(t){return T.setMaxFeedRate(Number.parseFloat(t.target.value))}})]})})),U=function(){function t(){Object(d.a)(this,t),this.enabled=!1,this.sensitivity=1,Object(h.d)(this)}return Object(f.a)(t,[{key:"toggle",value:function(){this.enabled=!this.enabled}},{key:"off",value:function(){this.enabled=!1}},{key:"setSensitivity",value:function(t){this.sensitivity=t}}]),t}(),q=Math.PI,B=function(t,e){if(!(t*t+e*e<.8)){var n=Math.atan(t/e);return e>0?q-n:t>0?-n:2*q-n}},V=function(){var t=v.selected;if(!t)return[void 0,void 0];var e=navigator.getGamepads()[t.index];if(!e)return[void 0,void 0];var n=e.axes;return[B(n[0],n[1]),B(n[2],n[3])]},$=Math.PI,K=Math.abs,Q=Math.max,X=String.fromCharCode(133),Y=function(){function t(e){var n=this;Object(d.a)(this,t),this.state=void 0,this.fetchInterval=void 0,this.lastAngles=[void 0,void 0],this.isStopped=!0,this.lastOk=!0,this.onOk=function(t){"ok"===t&&(n.lastOk=!0)},this.fetch=function(){var t=V();if(n.state.enabled&&n.lastOk){var e=t.map((function(t,e){return n.toDelta(t,n.lastAngles[e])})).map((function(t){return t&&t*n.state.sensitivity}));if(e.find((function(t){return void 0!==t}))){var i=n.normalize(e),o=Object(w.a)(i,2),c=o[0],a=o[1];n.jog({x:c,y:a,f:9999})}else n.stop()}n.lastAngles=t},this.state=e,Object(h.g)((function(){return e.enabled}),(function(){return e.enabled?n.on():n.off()}))}return Object(f.a)(t,[{key:"on",value:function(){var t;this.startIdleFetch(),null===(t=E())||void 0===t||t.on(this.onOk)}},{key:"off",value:function(){var t;this.stopIdleFetch(),null===(t=E())||void 0===t||t.off(this.onOk)}},{key:"startIdleFetch",value:function(){this.fetchInterval||(this.fetchInterval=setInterval(this.fetch,100))}},{key:"stopIdleFetch",value:function(){this.fetchInterval&&(clearInterval(this.fetchInterval),this.fetchInterval=void 0)}},{key:"normalize",value:function(t){var e=t.map((function(t){return t||0})).map(K).reduce((function(t,e){return Q(t,e)}),0);return e<1?t:t.map((function(t){return void 0!==t?t/e:void 0}))}},{key:"jog",value:function(t){var e,n=Object.entries(t).filter((function(t){return void 0!==Object(w.a)(t,2)[1]})).map((function(t){var e=Object(w.a)(t,2),n=e[0],i=e[1];return"".concat(n.toUpperCase()).concat(i.toFixed(4))})).join(" ");null===(e=E())||void 0===e||e.sendGcode("$J=G91 ".concat(n)),this.lastOk=!1,this.isStopped=!1}},{key:"toDelta",value:function(t,e){if(void 0!==t&&void 0!==e){var n=t-e,i=n>0?-2*$+n:2*$+n;return K(n)<K(i)?n:i}}},{key:"stop",value:function(){var t;this.isStopped||(null===(t=E())||void 0===t||t.sendGcode(X),this.isStopped=!0)}}]),t}(),Z=new U;new Y(Z);var _,tt,et=Z,nt=Object(l.a)((function(){return Object(c.useEffect)((function(){return function(){return et.off()}}),[]),Object(j.jsx)(p,{as:"button",onClick:function(){return et.toggle()},children:et.enabled?"knob enabled":"knob stopped"})})),it=Object(l.a)((function(){return Object(j.jsxs)("div",{children:["Sensitivity: "," ",Object(j.jsx)("input",{type:"number",step:.1,min:.1,value:et.sensitivity,onChange:function(t){return et.setSensitivity(Number.parseFloat(t.target.value))}})]})})),ot=b.a.div(_||(_=Object(u.a)(["\n    display: flex\n"]))),ct={Knob:function(){return Object(j.jsxs)("div",{children:[Object(j.jsx)(nt,{}),Object(j.jsx)(it,{})]})},"Jogger (Experimental)":function(){return Object(j.jsxs)("div",{children:[Object(j.jsx)(A,{}),Object(j.jsx)(N,{})]})}},at=function(){var t=Object(c.useState)((function(){return Object.keys(ct)[0]})),e=Object(w.a)(t,2),n=e[0],i=e[1],o=ct[n];return Object(j.jsxs)("div",{children:[Object(j.jsx)(ot,{children:Object.keys(ct).map((function(t){return Object(j.jsx)("button",{onClick:function(){return i(t)},disabled:n===t,children:t},t)}))}),Object(j.jsx)(o,{})]})},rt=b.a.div(tt||(tt=Object(u.a)(["\n    padding: 10px;\n"]))),st=function(){return Object(j.jsxs)(rt,{children:[Object(j.jsx)(y,{}),Object(j.jsx)(at,{}),Object(j.jsx)(O,{}),Object(j.jsx)(g,{}),Object(j.jsx)(m,{})]})},ut=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,95)).then((function(e){var n=e.getCLS,i=e.getFID,o=e.getFCP,c=e.getLCP,a=e.getTTFB;n(t),i(t),o(t),c(t),a(t)}))},lt=function(){window.addEventListener("gamepadconnected",(function(t){var e=t.gamepad,n=e.index,i=e.id;v.connected({index:n,name:i})})),window.addEventListener("gamepaddisconnected",(function(t){var e=t.gamepad,n=e.index,i=e.id;v.disconnected({index:n,name:i})}))},dt=n(93).default,ft=function(){new dt((function(){window.parent.postMessage({token:P.token,action:{type:"resize",payload:{clientHeight:document.body.clientHeight,clientWidth:document.body.clientWidth,offsetHeight:document.body.offsetHeight,offsetWidth:document.body.offsetWidth,scrollHeight:document.body.scrollHeight,scrollWidth:document.body.scrollWidth}}},"*")})).observe(document.body)};lt(),ft(),G(),s.a.render(Object(j.jsx)(a.a.StrictMode,{children:Object(j.jsx)(st,{})}),document.getElementById("root")),ut()}},[[94,1,2]]]);
//# sourceMappingURL=main.79b2c1fe.chunk.js.map