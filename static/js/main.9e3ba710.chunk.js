(this["webpackJsonpcncjs-widget-gamepad"]=this["webpackJsonpcncjs-widget-gamepad"]||[]).push([[0],{50:function(t,e,n){},56:function(t,e,n){var o=n(57);t.exports=function(t,e){var n=t.host,i=t.token,c="ws://".concat(n,"?token=").concat(i),s=o.connect("ws://".concat(n),{query:"token="+i});s.on("connect",(function(){console.log("Connected to "+c),e(null,s)})),s.on("error",(function(t){console.error("Connection error."),s&&(s.destroy(),s=null)})),s.on("close",(function(){console.log("Connection closed.")})),s.on("serialport:error",(function(t){e(new Error('Error opening serial port "'+t.port+'"'))})),s.on("serialport:read",(function(t){}))}},87:function(t,e){},92:function(t,e,n){"use strict";n.r(e);var o=n(3),i=n(4),c=function(){function t(e){return Object(o.a)(this,t),this.callback=null,this.observer=null,"function"===typeof e&&(this.callback=e),this}return Object(i.a)(t,[{key:"observe",value:function(t){var e=this;this.observer&&(this.observer.disconnect(),this.observer=null),this.callback&&this.callback(),this.observer=new MutationObserver((function(t){e.callback&&e.callback()})),this.observer.observe(t,{attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0})}},{key:"disconnect",value:function(){this.observer&&(this.observer.disconnect(),this.observer=null)}}]),t}();e.default=c},93:function(t,e,n){"use strict";n.r(e);var o,i,c=n(0),s=n.n(c),r=n(12),a=n.n(r),l=(n(50),n(13)),u=n(5),d=n(3),h=n(4),f=n(1),v=new(function(){function t(){Object(d.a)(this,t),this.selected=void 0,this.available=[],Object(f.d)(this)}return Object(h.a)(t,[{key:"connected",value:function(t){var e=this.available.findIndex((function(e){return e.index===t.index}));-1===e?this.available.push(t):this.available[e]=t}},{key:"disconnected",value:function(t){var e,n=this.available.findIndex((function(e){return e.index===t.index}));-1!==n&&this.available.splice(n,1),(null===(e=this.selected)||void 0===e?void 0:e.index)===t.index&&(this.selected=void 0)}},{key:"select",value:function(t){0!==this.available.filter((function(e){return e.index===t.index})).length&&(this.selected=t)}}]),t}()),b=n(14),p=b.a.div(o||(o=Object(l.a)(["\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    width: 100%;\n"]))),j=n(2),g=Object(u.a)((function(){return Object(j.jsx)(p,{children:v.selected?"using: ".concat(v.selected.name):"please select controller"})})),k=Object(u.a)((function(){return Object(j.jsx)("div",{children:v.available.map((function(t){return Object(j.jsx)(O,{gamepad:t},t.index)}))})})),O=function(t){var e=t.gamepad,n=e.name;return Object(j.jsx)(p,{as:"button",onClick:function(){return v.select(e)},children:n})},x=new(function(){function t(){Object(d.a)(this,t),this.port=void 0,Object(f.d)(this)}return Object(h.a)(t,[{key:"setPort",value:function(t){this.port=t}}]),t}()),y=Object(u.a)((function(){return Object(j.jsxs)("div",{children:["Port: ",x.port]})})),w=n(24),m=n.n(w),I=n(44),P=n(45),F=new URLSearchParams(window.location.search),C={token:F.get("token"),host:F.get("host")||""},L=n(56),S=function(){function t(e){Object(d.a)(this,t),this.socket=void 0,this.port=void 0,this.socket=e,this.port=void 0,this.setupListeners(),this.setupPort(),Object(f.d)(this)}return Object(h.a)(t,[{key:"sendGcode",value:function(t){this.port&&this.socket.emit("write",this.port,"".concat(t,"\n"))}},{key:"on",value:function(t){this.socket.on("serialport:read",t)}},{key:"off",value:function(t){this.socket.off("serialport:read",t)}},{key:"setupPort",value:function(){this.socket.emit("list")}},{key:"openPort",value:function(t){this.socket.emit("open",t)}},{key:"closePort",value:function(){this.port=void 0,x.setPort(void 0)}},{key:"setupListeners",value:function(){var t=this;this.socket.on("serialport:open",(function(e){var n=e.port;t.port=n,x.setPort(n)})),this.socket.on("serialport:list",(function(e){var n,o=null===(n=e.find((function(t){return t.inuse})))||void 0===n?void 0:n.port;o&&t.openPort(o)})),this.socket.on("serialport:change",(function(e){var n=e.port,o=e.inuse;n!==t.port||o?!t.port&&o&&t.openPort(n):t.closePort()}))}}]),t}(),H=function(){var t=Object(I.a)(m.a.mark((function t(){var e;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(P.promisify)(L)(C);case 2:e=t.sent,i=new S(e);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),W=function(){return i},z=function(t){return Math.abs(t)<.15?0:t>0?t-.15:t+.15},E=function(){var t=v.selected;if(!t)return{x:0,y:0,z:0};var e=navigator.getGamepads()[t.index];if(!e)return{x:0,y:0,z:0};var n=e.axes;return{x:z(n[0]),y:z(n[1]),z:z(n[3])}},G=String.fromCharCode(133),M=function(){function t(e){var n=this;Object(d.a)(this,t),this.state=void 0,this.isStopped=!0,this.fetchInterval=void 0,this.onOk=function(t){"ok"===t&&n.state.enabled&&n.fetch()},this.fetch=function(){if(n.state.enabled){var t,e=E(),o=e.x,i=e.y,c=e.z,s=o*o+i*i+c*c;if(0===s)n.stop();else null===(t=W())||void 0===t||t.sendGcode("$J=G91 X".concat(o," Y").concat(i," Z").concat(c," F").concat(1e3*Math.sqrt(s))),n.isStopped=!1,n.stopIdleFetch()}},this.state=e,Object(f.g)((function(){return e.enabled}),(function(){return e.enabled?n.on():n.off()}))}return Object(h.a)(t,[{key:"on",value:function(){var t;console.log("jogger on"),null===(t=W())||void 0===t||t.on(this.onOk),this.startIdleFetch()}},{key:"off",value:function(){var t;console.log("jogger off"),this.stop(),null===(t=W())||void 0===t||t.off(this.onOk),this.stopIdleFetch()}},{key:"stop",value:function(){var t;this.isStopped||(null===(t=W())||void 0===t||t.sendGcode(G),this.isStopped=!0,this.startIdleFetch())}},{key:"startIdleFetch",value:function(){this.fetchInterval||(this.fetchInterval=setInterval(this.fetch,20))}},{key:"stopIdleFetch",value:function(){this.fetchInterval&&(clearInterval(this.fetchInterval),this.fetchInterval=void 0)}}]),t}(),D=new(function(){function t(){Object(d.a)(this,t),this.enabled=!1,Object(f.d)(this)}return Object(h.a)(t,[{key:"toggle",value:function(){this.enabled=!this.enabled}}]),t}());new M(D);var J,q=D,B=Object(u.a)((function(){return Object(j.jsx)(p,{as:"button",onClick:function(){return q.toggle()},children:q.enabled?"jogging enabled":"jogging stopped"})})),T=b.a.div(J||(J=Object(l.a)(["\n    padding: 10px;\n"]))),V=function(){return Object(j.jsxs)(T,{children:[Object(j.jsx)(y,{}),Object(j.jsx)(B,{}),Object(j.jsx)(g,{}),Object(j.jsx)(k,{})]})},R=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,94)).then((function(e){var n=e.getCLS,o=e.getFID,i=e.getFCP,c=e.getLCP,s=e.getTTFB;n(t),o(t),i(t),c(t),s(t)}))},U=function(){window.addEventListener("gamepadconnected",(function(t){var e=t.gamepad,n=e.index,o=e.id;v.connected({index:n,name:o})})),window.addEventListener("gamepaddisconnected",(function(t){var e=t.gamepad,n=e.index,o=e.id;v.disconnected({index:n,name:o})}))},X=n(92).default,Y=function(){new X((function(){window.parent.postMessage({token:C.token,action:{type:"resize",payload:{clientHeight:document.body.clientHeight,clientWidth:document.body.clientWidth,offsetHeight:document.body.offsetHeight,offsetWidth:document.body.offsetWidth,scrollHeight:document.body.scrollHeight,scrollWidth:document.body.scrollWidth}}},"*")})).observe(document.body)};U(),Y(),H(),a.a.render(Object(j.jsx)(s.a.StrictMode,{children:Object(j.jsx)(V,{})}),document.getElementById("root")),R()}},[[93,1,2]]]);
//# sourceMappingURL=main.9e3ba710.chunk.js.map