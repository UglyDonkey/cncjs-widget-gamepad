(this["webpackJsonpcncjs-widget-gamepad"]=this["webpackJsonpcncjs-widget-gamepad"]||[]).push([[0],{51:function(e,t,n){},57:function(e,t,n){var o=n(58);e.exports=function(e,t){var n=e.host,i=e.token,c="ws://".concat(n,"?token=").concat(i),a=o.connect("ws://".concat(n),{query:"token="+i});a.on("connect",(function(){console.log("Connected to "+c),t(null,a)})),a.on("error",(function(e){console.error("Connection error."),a&&(a.destroy(),a=null)})),a.on("close",(function(){console.log("Connection closed.")})),a.on("serialport:error",(function(e){t(new Error('Error opening serial port "'+e.port+'"'))})),a.on("serialport:read",(function(e){}))}},88:function(e,t){},93:function(e,t,n){"use strict";n.r(t);var o=n(3),i=n(4),c=function(){function e(t){return Object(o.a)(this,e),this.callback=null,this.observer=null,"function"===typeof t&&(this.callback=t),this}return Object(i.a)(e,[{key:"observe",value:function(e){var t=this;this.observer&&(this.observer.disconnect(),this.observer=null),this.callback&&this.callback(),this.observer=new MutationObserver((function(e){t.callback&&t.callback()})),this.observer.observe(e,{attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0})}},{key:"disconnect",value:function(){this.observer&&(this.observer.disconnect(),this.observer=null)}}]),e}();t.default=c},94:function(e,t,n){"use strict";n.r(t);var o,i,c=n(0),a=n.n(c),s=n(12),r=n.n(s),u=(n(51),n(13)),l=n(5),d=n(3),h=n(4),f=n(2),v=new(function(){function e(){Object(d.a)(this,e),this.selected=void 0,this.available=[],this.deadzone=.15,Object(f.d)(this)}return Object(h.a)(e,[{key:"connected",value:function(e){var t=this.available.findIndex((function(t){return t.index===e.index}));-1===t?this.available.push(e):this.available[t]=e}},{key:"disconnected",value:function(e){var t,n=this.available.findIndex((function(t){return t.index===e.index}));-1!==n&&this.available.splice(n,1),(null===(t=this.selected)||void 0===t?void 0:t.index)===e.index&&(this.selected=void 0)}},{key:"select",value:function(e){0!==this.available.filter((function(t){return t.index===e.index})).length&&(this.selected=e)}},{key:"normalize",get:function(){return 1/(1-this.deadzone)}},{key:"setDeadzone",value:function(e){this.deadzone=e}}]),e}()),b=n(14),p=b.a.div(o||(o=Object(u.a)(["\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    width: 100%;\n"]))),j=n(1),g=Object(l.a)((function(){return Object(j.jsx)(p,{children:v.selected?"using: ".concat(v.selected.name):"please select gamepad"})})),k=Object(l.a)((function(){return Object(j.jsx)("div",{children:0===v.available.length?"no gamepads detected":v.available.map((function(e){return Object(j.jsx)(x,{gamepad:e},e.index)}))})})),x=function(e){var t=e.gamepad,n=t.name;return Object(j.jsx)(p,{as:"button",onClick:function(){return v.select(t)},children:n})},O=new(function(){function e(){Object(d.a)(this,e),this.port=void 0,Object(f.d)(this)}return Object(h.a)(e,[{key:"setPort",value:function(e){this.port=e}}]),e}()),m=Object(l.a)((function(){return Object(j.jsxs)("div",{children:["Port: ",O.port]})})),y=n(46),w=n(24),F=n.n(w),I=n(44),z=n(45),P=new URLSearchParams(window.location.search),C={token:P.get("token"),host:P.get("host")||""},D=n(57),L=function(){function e(t){Object(d.a)(this,e),this.socket=void 0,this.port=void 0,this.socket=t,this.port=void 0,this.setupListeners(),this.setupPort(),Object(f.d)(this)}return Object(h.a)(e,[{key:"sendGcode",value:function(e){this.port&&this.socket.emit("write",this.port,"".concat(e,"\n"))}},{key:"on",value:function(e){this.socket.on("serialport:read",e)}},{key:"off",value:function(e){this.socket.off("serialport:read",e)}},{key:"setupPort",value:function(){this.socket.emit("list")}},{key:"openPort",value:function(e){this.socket.emit("open",e)}},{key:"closePort",value:function(){this.port=void 0,O.setPort(void 0)}},{key:"setupListeners",value:function(){var e=this;this.socket.on("serialport:open",(function(t){var n=t.port;e.port=n,O.setPort(n)})),this.socket.on("serialport:list",(function(t){var n,o=null===(n=t.find((function(e){return e.inuse})))||void 0===n?void 0:n.port;o&&e.openPort(o)})),this.socket.on("serialport:change",(function(t){var n=t.port,o=t.inuse;n!==e.port||o?!e.port&&o&&e.openPort(n):e.closePort()}))}}]),e}(),M=function(){var e=Object(I.a)(F.a.mark((function e(){var t;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(z.promisify)(D)(C);case 2:t=e.sent,i=new L(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),R=function(){return i},S=function(e){var t=v.deadzone,n=v.normalize;return Math.abs(e)<t?0:e>0?(e-t)*n:(e+t)*n},H=function(){var e=v.selected;if(!e)return{x:0,y:0,z:0};var t=navigator.getGamepads()[e.index];if(!t)return{x:0,y:0,z:0};var n=t.axes;return{x:S(n[0]),y:S(-n[1]),z:S(-n[3])}},W=String.fromCharCode(133),E=function(){function e(t){var n=this;Object(d.a)(this,e),this.state=void 0,this.isStopped=!0,this.fetchInterval=void 0,this.lastFetch=0,this.onOk=function(e){"ok"===e&&n.state.enabled&&n.fetch()},this.fetch=function(){if(n.state.enabled){var e=Math.min(n.getDt(),15),t=H(),o=t.x,i=t.y,c=t.z,a=o*o+i*i+c*c;if(0===a)n.stop();else{var s=Math.sqrt(a)*J.maxFeedRate,r=.001*s*e;console.log({x:o,f:s,dt:e,multiplier:r}),n.jog({x:o*r,y:i*r,z:c*r,f:s}),n.isStopped=!1,n.stopIdleFetch()}}},this.state=t,Object(f.g)((function(){return t.enabled}),(function(){return t.enabled?n.on():n.off()}))}return Object(h.a)(e,[{key:"on",value:function(){var e;console.log("jogger on"),null===(e=R())||void 0===e||e.on(this.onOk),this.lastFetch=(new Date).getTime(),this.startIdleFetch()}},{key:"off",value:function(){var e;console.log("jogger off"),this.stop(),null===(e=R())||void 0===e||e.off(this.onOk),this.stopIdleFetch()}},{key:"getDt",value:function(){var e=(new Date).getTime(),t=e-this.lastFetch;return this.lastFetch=e,t}},{key:"jog",value:function(e){var t,n=Object.entries(e).map((function(e){var t=Object(y.a)(e,2),n=t[0],o=t[1];return"".concat(n.toUpperCase()).concat(o.toFixed(4))})).join(" ");null===(t=R())||void 0===t||t.sendGcode("$J=G91 ".concat(n))}},{key:"stop",value:function(){var e;this.isStopped||(null===(e=R())||void 0===e||e.sendGcode(W),this.isStopped=!0,this.startIdleFetch())}},{key:"startIdleFetch",value:function(){this.fetchInterval||(this.fetchInterval=setInterval(this.fetch,20))}},{key:"stopIdleFetch",value:function(){this.fetchInterval&&(clearInterval(this.fetchInterval),this.fetchInterval=void 0)}}]),e}(),G=new(function(){function e(){Object(d.a)(this,e),this.enabled=!1,this.maxFeedRate=300,Object(f.d)(this)}return Object(h.a)(e,[{key:"toggle",value:function(){this.enabled=!this.enabled}},{key:"setMaxFeedRate",value:function(e){this.maxFeedRate=e}}]),e}());new E(G);var T,J=G,q=Object(l.a)((function(){return Object(j.jsx)(p,{as:"button",onClick:function(){return J.toggle()},children:J.enabled?"jogging enabled":"jogging stopped"})})),B=Object(l.a)((function(){return Object(j.jsxs)("div",{children:["Feed Rate:"," ",Object(j.jsx)("input",{type:"number",value:J.maxFeedRate,onChange:function(e){return J.setMaxFeedRate(Number.parseFloat(e.target.value))}})]})})),N=Object(l.a)((function(){return Object(j.jsxs)("div",{children:["Deadzone:"," ",Object(j.jsx)("input",{type:"number",value:v.deadzone,onChange:function(e){return v.setDeadzone(Number.parseFloat(e.target.value))}})]})})),U=b.a.div(T||(T=Object(u.a)(["\n    padding: 10px;\n"]))),V=function(){return Object(j.jsxs)(U,{children:[Object(j.jsx)(m,{}),Object(j.jsx)(q,{}),Object(j.jsx)(B,{}),Object(j.jsx)(g,{}),Object(j.jsx)(k,{}),Object(j.jsx)(N,{})]})},$=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,95)).then((function(t){var n=t.getCLS,o=t.getFID,i=t.getFCP,c=t.getLCP,a=t.getTTFB;n(e),o(e),i(e),c(e),a(e)}))},A=function(){window.addEventListener("gamepadconnected",(function(e){var t=e.gamepad,n=t.index,o=t.id;v.connected({index:n,name:o})})),window.addEventListener("gamepaddisconnected",(function(e){var t=e.gamepad,n=t.index,o=t.id;v.disconnected({index:n,name:o})}))},K=n(93).default,Q=function(){new K((function(){window.parent.postMessage({token:C.token,action:{type:"resize",payload:{clientHeight:document.body.clientHeight,clientWidth:document.body.clientWidth,offsetHeight:document.body.offsetHeight,offsetWidth:document.body.offsetWidth,scrollHeight:document.body.scrollHeight,scrollWidth:document.body.scrollWidth}}},"*")})).observe(document.body)};A(),Q(),M(),r.a.render(Object(j.jsx)(a.a.StrictMode,{children:Object(j.jsx)(V,{})}),document.getElementById("root")),$()}},[[94,1,2]]]);
//# sourceMappingURL=main.65349d91.chunk.js.map